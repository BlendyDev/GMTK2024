[gd_scene load_steps=30 format=3 uid="uid://gmvcn505pthw"]

[ext_resource type="Script" path="res://scenes/level/tutorial/tutorial.gd" id="1_25kjh"]
[ext_resource type="Script" path="res://scripts/camera.gd" id="1_35dlq"]
[ext_resource type="PackedScene" uid="uid://cg154e3cwcjlr" path="res://scenes/nabo.tscn" id="2_63ibo"]
[ext_resource type="PackedScene" uid="uid://cfxu1avgtg8ep" path="res://scenes/turtle.tscn" id="2_ikfup"]
[ext_resource type="PackedScene" uid="uid://b5tdw8pl3e3wk" path="res://scenes/rat.tscn" id="2_iqgoo"]
[ext_resource type="Script" path="res://scenes/Lupa.gd" id="2_oo63b"]
[ext_resource type="PackedScene" uid="uid://rbxwo6tm8may" path="res://scenes/door.tscn" id="2_s51ea"]
[ext_resource type="Texture2D" uid="uid://cwk7w6udwbccn" path="res://sprites/lupa.png" id="3_5pn54"]
[ext_resource type="PackedScene" uid="uid://dpyt0d7rtyl5q" path="res://scenes/level/tutorial/level.tscn" id="3_sdsex"]
[ext_resource type="PackedScene" uid="uid://bexhqp2l7qrs5" path="res://scenes/ramiro.tscn" id="4_8l1hf"]
[ext_resource type="Script" path="res://scripts/Intersection.gd" id="4_10di6"]
[ext_resource type="Texture2D" uid="uid://bsgfl5qneehqb" path="res://sprites/lupaMask.png" id="4_25cno"]
[ext_resource type="Texture2D" uid="uid://buhy3lr105ut7" path="res://sprites/inverseLupaMask.png" id="5_fejvq"]
[ext_resource type="TileSet" uid="uid://b5aeklwp8y8qw" path="res://misc/spikeTileset.tres" id="5_itr7s"]
[ext_resource type="Script" path="res://tmp/ScaledLevel.gd" id="6_gy86c"]
[ext_resource type="PackedScene" uid="uid://dmrb4fssxeks1" path="res://scenes/level/tutorial/scaledLevel.tscn" id="7_gb8ua"]
[ext_resource type="PackedScene" uid="uid://6guy5rxqs3n2" path="res://scenes/player.tscn" id="8_d5r2p"]
[ext_resource type="TileSet" uid="uid://b5vwlvpqxy1v1" path="res://misc/inverseSpikeTileset.tres" id="8_pn5fs"]
[ext_resource type="TileSet" uid="uid://d338qiepy3cw8" path="res://misc/inverseTileset.tres" id="9_n858l"]

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_k1rsb"]
light_mode = 2

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_owqnw"]
light_mode = 2

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_2ynss"]
light_mode = 2

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_56md7"]
light_mode = 2

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_sq0wt"]
light_mode = 2

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_a2mql"]
light_mode = 2

[sub_resource type="Animation" id="Animation_2u5cd"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("CanvasLayer/ColorRect:color")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(0, 0, 0, 0)]
}

[sub_resource type="Animation" id="Animation_f0lge"]
resource_name = "fadein"
length = 3.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("CanvasLayer/ColorRect:color")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.5, 3),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Color(0, 0, 0, 1), Color(0, 0, 0, 1), Color(0, 0, 0, 0)]
}

[sub_resource type="Animation" id="Animation_4wejx"]
resource_name = "fadeout"
length = 3.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("CanvasLayer/ColorRect:color")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1, 3),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Color(0, 0, 0, 0), Color(0, 0, 0, 0), Color(0, 0, 0, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_tmkbs"]
_data = {
"RESET": SubResource("Animation_2u5cd"),
"fadein": SubResource("Animation_f0lge"),
"fadeout": SubResource("Animation_4wejx")
}

[node name="Game" type="Node2D"]
script = ExtResource("1_25kjh")

[node name="Camera2D" type="Camera2D" parent="." node_paths=PackedStringArray("player")]
offset = Vector2(100, 200)
zoom = Vector2(2, 2)
script = ExtResource("1_35dlq")
player = NodePath("../Player")

[node name="DoorHandler" parent="." node_paths=PackedStringArray("player") instance=ExtResource("2_s51ea")]
position = Vector2(2191, 323)
player = NodePath("../Player")

[node name="Nabo" parent="." instance=ExtResource("2_63ibo")]
position = Vector2(211, 210)

[node name="Rat" parent="." instance=ExtResource("2_iqgoo")]
position = Vector2(1525, 345)

[node name="Turtle" parent="." instance=ExtResource("2_ikfup")]
position = Vector2(621, 345)

[node name="Ramiro" parent="." instance=ExtResource("4_8l1hf")]
position = Vector2(1057, 345)

[node name="Player" parent="." node_paths=PackedStringArray("lupa", "camera") instance=ExtResource("8_d5r2p")]
lupa = NodePath("../Lupa")
camera = NodePath("../Camera2D")

[node name="Lupa" type="Area2D" parent="." node_paths=PackedStringArray("main", "scaled", "alt", "invis", "mainTilemap", "mainSpikesTilemap", "player")]
collision_layer = 2
script = ExtResource("2_oo63b")
main = NodePath("../LevelHandler/Main")
scaled = NodePath("../LevelHandler/Scaled")
alt = NodePath("../LevelHandler/Alternative")
invis = NodePath("../LevelHandler/Invisible")
mainTilemap = NodePath("../LevelHandler/Main/Level")
mainSpikesTilemap = NodePath("../LevelHandler/Main/Spikes")
player = NodePath("../Player")

[node name="Sprite2D" type="Sprite2D" parent="Lupa"]
z_index = 100
texture_filter = 1
position = Vector2(-35.0001, 35)
texture = ExtResource("3_5pn54")
hframes = 8

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Lupa"]
position = Vector2(-29.0001, 29)
polygon = PackedVector2Array(21, -86, 36, -86, 53, -81, 69, -69, 81, -53, 86, -36, 86, -21, 81, -4, 69, 12, 53, 24, 36, 29, 21, 29, 4, 24, -12, 12, -24, -4, -29, -21, -29, -36, -24, -53, -12, -69, 4, -81)

[node name="Mask" type="PointLight2D" parent="Lupa"]
texture_filter = 1
position = Vector2(-35.0001, 35)
energy = 0.0
range_item_cull_mask = 2
texture = ExtResource("4_25cno")

[node name="InvMask" type="PointLight2D" parent="Lupa"]
light_mask = 2
visibility_layer = 2
texture_filter = 1
position = Vector2(3, 1)
scale = Vector2(1.05, 1.05)
energy = 0.0
texture = ExtResource("5_fejvq")

[node name="LupaHitbox" type="StaticBody2D" parent="Lupa"]
collision_layer = 32
collision_priority = 0.135

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Lupa/LupaHitbox"]
position = Vector2(-29.0001, 29)
polygon = PackedVector2Array(21, -86, 36, -86, 53, -81, 69, -69, 81, -53, 86, -36, 86, -21, 81, -4, 69, 12, 53, 24, 36, 29, 21, 29, 4, 24, -8.9999, 18, -11.9999, 20, -14.9999, 26, -24.9999, 33, -27.9999, 35, -69.9999, 76, -72.9999, 81, -74.9999, 81, -74.9999, 84, -79.9999, 90, -83.9999, 92, -86.9999, 93, -92.9999, 93, -94.9999, 91, -94.9999, 85, -93.9999, 82, -91.9999, 78, -85.9999, 73, -82.9999, 73, -82.9999, 71, -77.9999, 68, -36.9999, 26, -34.9999, 23, -27.9999, 13, -21.9999, 10, -19.9999, 7, -24, -4, -29, -21, -29, -36, -24, -53, -12, -69, 4, -81)

[node name="LevelHandler" type="Node2D" parent="."]

[node name="Main" type="Node2D" parent="LevelHandler"]

[node name="Level" parent="LevelHandler/Main" instance=ExtResource("3_sdsex")]
position = Vector2(0.5, 0.5)

[node name="LevelIntersection" type="StaticBody2D" parent="LevelHandler/Main" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 8
collision_mask = 0
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../Level")
player = NodePath("../../../Player")

[node name="Spikes" type="TileMap" parent="LevelHandler/Main"]
material = SubResource("CanvasItemMaterial_k1rsb")
tile_set = ExtResource("5_itr7s")
format = 2
layer_0/name = "Default"

[node name="SpikesIntersection" type="Area2D" parent="LevelHandler/Main" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 128
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../Spikes")
player = NodePath("../../../Player")

[node name="Scaled" type="Node2D" parent="LevelHandler"]

[node name="ScaledLevel" type="Node2D" parent="LevelHandler/Scaled" node_paths=PackedStringArray("lupa")]
position = Vector2(-1000, 0)
script = ExtResource("6_gy86c")
lupa = NodePath("../../../Lupa")

[node name="ScaledLevel" parent="LevelHandler/Scaled/ScaledLevel" instance=ExtResource("7_gb8ua")]

[node name="ScaledLevelIntersection" type="StaticBody2D" parent="LevelHandler/Scaled" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 8
collision_mask = 0
collision_priority = 0.135
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../ScaledLevel/ScaledLevel")
inverseMode = true
player = NodePath("../../../Player")

[node name="ScaledSpikes" type="Node2D" parent="LevelHandler/Scaled" node_paths=PackedStringArray("lupa")]
position = Vector2(-1000, 0)
script = ExtResource("6_gy86c")
lupa = NodePath("../../../Lupa")

[node name="ScaledSpikes" type="TileMap" parent="LevelHandler/Scaled/ScaledSpikes"]
light_mask = 2
material = SubResource("CanvasItemMaterial_owqnw")
tile_set = ExtResource("8_pn5fs")
format = 2
layer_0/name = "Default"

[node name="ScaledSpikesIntersection" type="Area2D" parent="LevelHandler/Scaled" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 128
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../ScaledSpikes/ScaledSpikes")
inverseMode = true
player = NodePath("../../../Player")

[node name="Alternative" type="Node2D" parent="LevelHandler"]

[node name="AlternativeLevel" type="TileMap" parent="LevelHandler/Alternative"]
light_mask = 2
material = SubResource("CanvasItemMaterial_2ynss")
tile_set = ExtResource("9_n858l")
format = 2
layer_0/name = "Default"
layer_1/name = "Background"
layer_1/z_index = -50
layer_1/tile_data = PackedInt32Array()

[node name="AlternativeLevelIntersection" type="StaticBody2D" parent="LevelHandler/Alternative" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 8
collision_mask = 0
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../AlternativeLevel")
inverseMode = true
player = NodePath("../../../Player")

[node name="AlternativeSpikes" type="TileMap" parent="LevelHandler/Alternative"]
light_mask = 2
material = SubResource("CanvasItemMaterial_56md7")
tile_set = ExtResource("8_pn5fs")
format = 2
layer_0/name = "Default"

[node name="AlternativeSpikesIntersection" type="Area2D" parent="LevelHandler/Alternative" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 128
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../AlternativeSpikes")
inverseMode = true
player = NodePath("../../../Player")

[node name="Invisible" type="Node2D" parent="LevelHandler"]

[node name="InvisibleLevel" type="TileMap" parent="LevelHandler/Invisible"]
light_mask = 2
material = SubResource("CanvasItemMaterial_sq0wt")
tile_set = ExtResource("9_n858l")
format = 2
layer_0/name = "Default"
layer_1/name = "Background"
layer_1/z_index = -50
layer_1/tile_data = PackedInt32Array()

[node name="InvisibleLevelIntersection" type="StaticBody2D" parent="LevelHandler/Invisible" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 8
collision_mask = 0
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../InvisibleLevel")
inverseMode = true
player = NodePath("../../../Player")

[node name="InvisibleSpikes" type="TileMap" parent="LevelHandler/Invisible"]
light_mask = 2
material = SubResource("CanvasItemMaterial_a2mql")
tile_set = ExtResource("8_pn5fs")
format = 2
layer_0/name = "Background"

[node name="InvisibleSpikesIntersection" type="Area2D" parent="LevelHandler/Invisible" node_paths=PackedStringArray("lupa", "tilemap", "player")]
collision_layer = 128
script = ExtResource("4_10di6")
lupa = NodePath("../../../Lupa")
tilemap = NodePath("../InvisibleSpikes")
inverseMode = true
player = NodePath("../../../Player")

[node name="Transitions" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_tmkbs")
}

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="ColorRect" type="ColorRect" parent="CanvasLayer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0)

[node name="TransitionTime" type="Timer" parent="."]
wait_time = 3.0
one_shot = true

[connection signal="area_entered" from="DoorHandler" to="DoorHandler" method="_on_area_entered"]
[connection signal="mouse_entered" from="Nabo" to="Nabo" method="_on_mouse_entered"]
[connection signal="mouse_exited" from="Nabo" to="Nabo" method="_on_mouse_exited"]
[connection signal="body_entered" from="Lupa" to="Lupa" method="bodyEntered"]
[connection signal="body_exited" from="Lupa" to="Lupa" method="bodyExited"]
[connection signal="scaleLevelChanged" from="Lupa" to="LevelHandler/Scaled/ScaledLevel" method="scaleLevelChange"]
[connection signal="scaleLevelChanged" from="Lupa" to="LevelHandler/Scaled/ScaledSpikes" method="scaleLevelChange"]
[connection signal="timeout" from="TransitionTime" to="." method="_on_transition_time_timeout"]
